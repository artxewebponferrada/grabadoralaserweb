---
import Layout from '../../layouts/Layout.astro';
import { AFFILIATE_TAG } from '../../constants';
import data from '../../data';

export async function getStaticPaths() {
  // Obtener todos los DPs únicos de los productos
  const dps = data.products.map(product => {
    const match = product.affiliateUrl.match(/\/([A-Z0-9]{10})(?:\/|\?|$)/);
    return match ? match[1] : null;
  }).filter(Boolean);

  return dps.map(dp => ({
    params: { dp },
  }));
}

const { dp } = Astro.params;
const amazonUrl = `https://www.amazon.es/dp/${dp}?tag=${AFFILIATE_TAG}`;
---

<Layout 
  title="Redirigiendo a Amazon"
  description="Redirigiendo a Amazon..."
  noindex={true}
>
  <div class="min-h-screen flex items-center justify-center">
    <div class="text-center">
      <div class="mb-4">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-primary-600 mx-auto"></div>
      </div>
      <h1 class="text-2xl font-semibold text-gray-900 mb-2">Redirigiendo a Amazon</h1>
      <p class="text-gray-600">Por favor, espera un momento...</p>
    </div>
  </div>
</Layout>

<script define:vars={{ amazonUrl }}>
// Redirigir después de 1 segundo
setTimeout(() => {
  window.location.href = amazonUrl;
}, 1000);
</script>