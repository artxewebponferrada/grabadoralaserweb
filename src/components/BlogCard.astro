---
import { format } from 'date-fns';
import { es } from 'date-fns/locale';

interface Props {
  title: string;
  slug: string;
  excerpt: string;
  publishDate: string;
  author: {
    name: string;
    avatar: string;
  };
  tags: string[];
  featuredImage?: string;
  imageAlt?: string;
}

const {
  title,
  slug,
  excerpt,
  publishDate,
  author,
  tags,
  featuredImage,
  imageAlt
} = Astro.props;

// Fallback si no hay featuredImage en el JSON
const cover = featuredImage ?? `/imagenes/${slug}.jpg`;
const alt = imageAlt ?? title;
---

<article class="group bg-white rounded-2xl overflow-hidden shadow-card hover:shadow-hover transition-all duration-300">
  <!-- Imagen del post -->
  <a href={`/blog/${slug}/`} class="block">
    <figure class="aspect-w-16 aspect-h-9 bg-gray-100 relative overflow-hidden">
      <img
        src={cover}
        alt={alt}
        loading="lazy"
        decoding="async"
        class="w-full h-full object-cover object-center transition-transform duration-500 group-hover:scale-[1.03]"
        width="1280"
        height="720"
      />
      <!-- Overlay suave (azul de tu paleta) -->
      <div class="absolute inset-0 bg-gradient-to-t from-primary-900/15 to-transparent"></div>
    </figure>
  </a>

  <div class="p-6">
    <header class="mb-4">
      <div class="flex items-center gap-3">
        <img
          src={author.avatar}
          alt={author.name}
          class="w-10 h-10 rounded-full object-cover ring-2 ring-gray-100"
          loading="lazy"
          decoding="async"
        />
        <div class="flex flex-col">
          <strong class="text-sm text-gray-900">{author.name}</strong>
          <time datetime={publishDate} class="text-sm text-gray-500">
            {format(
              new Date(publishDate),
              "d 'de' MMMM 'de' yyyy",
              { locale: es }
            )}
          </time>
        </div>
      </div>
    </header>

    <h2 class="text-xl font-bold text-gray-900 group-hover:text-primary-600 transition-colors mb-3">
      <a
        href={`/blog/${slug}/`}
        class="focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 rounded-lg"
      >
        {title}
      </a>
    </h2>

    <p class="text-base text-gray-600 line-clamp-2 mb-4">
      {excerpt}
    </p>

    <footer class="flex flex-wrap gap-2">
      {tags.map((tag) => (
        <a
          href={`/blog/tags/${tag}/`}
          class="text-sm font-medium px-3 py-1 rounded-full bg-gray-100 text-gray-700 hover:bg-primary-50 hover:text-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 transition-colors"
        >
          #{tag}
        </a>
      ))}
    </footer>
  </div>
</article>
